/* Variables */
:root {
    /* Strings */
    --compact-list-separator: ' | ';

    --disambiguation-separator: ', ';
    --disambiguation-reading-separator: ':';

    --headword-separator: '\3001';

    --inflection-separator: '\00AB';

    /* Layout */
    --font-size-no-units: 14;
    --font-size: calc(1px * var(--font-size-no-units));
    --query-parser-font-size-no-units: 2;
    --query-parser-font-size: calc(1em * var(--query-parser-font-size-no-units));
    --h2-font-size-no-units: 1.25;
    --h2-font-size: calc(1em * var(--h2-font-size-no-units));

    --headword-font-size-no-units: 2;
    --headword-font-size: calc(1em * var(--headword-font-size-no-units));
    --headword-reading-font-size-no-units: 0.75;
    --headword-reading-font-size: calc(var(--headword-reading-font-size-no-units) * var(--headword-font-size));
    --headword-reading-space: 0.5em;
    --headword-list-end-space: 0.5em;
    --headword-thin-border-size: calc(1em / (var(--headword-font-size-no-units) * var(--font-size-no-units)));

    --line-height-no-units: 20;
    --line-height: calc(var(--line-height-no-units) / var(--font-size-no-units));

    --thin-border-size: calc(1em / var(--font-size-no-units));

    --action-button-size-no-units: 16;
    --action-button-size: calc(1em * (var(--action-button-size-no-units) / var(--font-size-no-units)));
    --action-button-padding: 0.3em;

    --list-margin: 0.72em;
    --content-width: 100%;
    --main-content-vertical-padding: 0em;
    --main-content-horizontal-padding: 0em;
    --entry-horizontal-padding: 1em;
    /* More breathing room */
    --entry-vertical-padding: 1em;
    --query-horizontal-padding: 1em;

    --sidebar-width-no-units: 40;
    --sidebar-width: calc(1em * (var(--sidebar-width-no-units) / var(--font-size-no-units)));
    --sidebar-button-height-no-units: 30;
    --sidebar-button-height: calc(1em * (var(--sidebar-button-height-no-units) / var(--font-size-no-units)));
    --sidebar-button-icon-size-no-units: 16;
    --sidebar-button-icon-size: calc(1em * (var(--sidebar-button-icon-size-no-units) / var(--font-size-no-units)));

    --progress-bar-height-no-units: 4;
    --progress-bar-height: calc(1em * (var(--progress-bar-height-no-units) / var(--font-size-no-units)));
    --progress-bar-active-transition-duration: 0.125s;
    --progress-bar-active-transition-start-delay: 0.0625s;
    --progress-bar-animation-duration: 2s;

    --entry-current-indicator-width-no-units: 4;
    --entry-current-indicator-width: calc(1em * var(--entry-current-indicator-width-no-units) / var(--font-size-no-units));
    --entry-current-indicator-transition-duration: 0.125s;

    --tag-height-no-units: 22;
    --tag-height: calc(1em * var(--tag-height-no-units) / var(--font-size-no-units));
    --tag-font-size-no-units: 11;
    --tag-font-size: calc(1em * var(--tag-font-size-no-units) / var(--font-size-no-units));
    --tag-border-size-no-units: 1;
    --tag-border-size: calc(1em * (var(--tag-border-size-no-units) / var(--font-size-no-units)));
    --tag-border-style: solid;
    --tag-font-weight: bold;
    --tag-border-radius: 99px;
    /* Pill Shape */

    --list-padding1: 1.4em;
    --list-padding2: var(--list-padding1);

    --entry-current-indicator-triangle-size-no-units: 6;
    --entry-current-indicator-triangle-size: calc(1em * (var(--entry-current-indicator-triangle-size-no-units) / var(--font-size-no-units)));

    --overlay-panel-translate-distance: 4em;

    --disambiguation-space: 0.25em;

    --animation-duration: 0.125s;
    --animation-duration2: calc(2 * var(--animation-duration));

    --collapsible-definition-line-count: 3;
    --collapsible-kanji-glyph-data-line-count: 3;
    --kanji-glyph-table-header-height: calc((20em / var(--font-size-no-units)) + var(--kanji-glyph-table-cell-padding) * 3);
    --collapsible-definition-test-offset: 0.2em;
    --collpasible-kanji-glyph-data-test-offset: 0.2em;

    /* Colors */
    /* Colors */
    --background-color: var(--wanchan-bg-light);
    --gloss-image-background-color: #eeeeee;
    --link-color: var(--wanchan-amber-dark);

    --text-color: var(--wanchan-text-primary-light);
    --reason-text-color: var(--text-color-light3);

    --headword-text-color: var(--text-color);
    --headword-text-color-popular: var(--wanchan-purple-light);
    --headword-text-color-rare: var(--text-color-light4);
    --headword-furigana-text-color: var(--headword-text-color);
    --headword-furigana-text-color-popular: var(--headword-text-color-popular);
    --headword-furigana-text-color-rare: var(--headword-text-color-rare);
    --headword-reading-text-color: var(--headword-furigana-text-color);
    --headword-reading-text-color-popular: var(--headword-furigana-text-color-popular);
    --headword-reading-text-color-rare: var(--headword-furigana-text-color-rare);
    --headword-kanji-text-color: var(--headword-text-color);
    --headword-kanji-text-color-popular: var(--headword-text-color-popular);
    --headword-kanji-text-color-rare: var(--headword-text-color-rare);
    --headword-kanji-border-color: var(--dark-border-color);
    --headword-kanji-border-color-popular: var(--headword-kanji-border-color);
    --headword-kanji-border-color-rare: var(--headword-kanji-border-color);

    --kanji-glyph-table-cell-padding: 0.36em;

    --light-border-color: var(--wanchan-border-light);
    --medium-border-color: #dddddd;
    --dark-border-color: #777777;

    --tag-text-color: #ffffff;
    --tag-border-color: transparent;
    --tag-default-background-color: var(--wanchan-slate);
    --tag-name-background-color: #9333ea;
    --tag-expression-background-color: #f59e0b;
    --tag-popular-background-color: #2563eb;
    --tag-frequent-background-color: #0ea5e9;
    --tag-archaism-background-color: #dc2626;
    --tag-dictionary-background-color: #7c3aed;
    --tag-frequency-background-color: #059669;
    --tag-part-of-speech-background-color: #4b5563;
    --tag-search-background-color: #64748b;
    --tag-pronunciation-dictionary-background-color: #7c3aed;

    --sidebar-background-color: #f8f9fa;

    --sidebar-button-background-color: transparent;
    --sidebar-button-background-color-hover: #cccccc;
    --sidebar-button-background-color-active: #aaaaaa;
    --sidebar-button-danger-background-color: transparent;
    --sidebar-button-danger-background-color-hover: #dd2222;
    --sidebar-button-danger-background-color-active: #bb2222;
    --sidebar-button-icon-color: #333333;
    --sidebar-button-disabled-icon-color: #888888;
    --sidebar-button-danger-icon-color: #ffffff;

    --scrollbar-thumb-color: #c1c1c1;
    --scrollbar-track-color: #f1f1f1;
    --scrollbar-inverse-thumb-color: #444444;
    --scrollbar-inverse-track-color: #2f2f2f;

    --progress-bar-track-color: #cccccc;
    --progress-bar-indicator-color: var(--accent-color);
    --entry-current-indicator-color: var(--accent-color);

    --notification-text-color: #2f2f2f;
    --notification-background-color: #f1f1f1;
    --notification-background-color-light: #e1e1e1;
    --notification-background-color-lighter: #bbbbbb;
    --notification-shadow-color: rgba(255, 255, 255, 0.25);

    --action-button-hover-color: #dddddd;
    --action-button-active-color: #c1c1c1;
}

:root[data-theme=dark] {
    /* Colors */
    --background-color: var(--wanchan-bg-dark);
    --gloss-image-background-color: #2f2f2f;
    --link-color: var(--wanchan-amber);

    --text-color: var(--wanchan-text-primary-dark);
    --reason-text-color: var(--text-color-light3);

    --headword-text-color: var(--text-color);
    --headword-text-color-popular: var(--wanchan-amber);
    --headword-text-color-rare: var(--text-color-light4);
    --headword-furigana-text-color: var(--headword-text-color);
    --headword-furigana-text-color-popular: var(--headword-text-color-popular);
    --headword-furigana-text-color-rare: var(--headword-text-color-rare);
    --headword-reading-text-color: var(--headword-furigana-text-color);
    --headword-reading-text-color-popular: var(--headword-furigana-text-color-popular);
    --headword-reading-text-color-rare: var(--headword-furigana-text-color-rare);
    --headword-kanji-border-color: var(--dark-border-color);

    --light-border-color: var(--wanchan-border-dark);
    --medium-border-color: #3f3f3f;
    --dark-border-color: #888888;

    --tag-text-color: #f1f1f1;
    --tag-border-color: transparent;
    --tag-default-background-color: #66648b;
    --tag-name-background-color: #9333ea;
    --tag-expression-background-color: #d97706;
    --tag-popular-background-color: #1d4ed8;
    --tag-frequent-background-color: #0284c7;
    --tag-archaism-background-color: #b91c1c;
    --tag-dictionary-background-color: #7c3aed;
    --tag-frequency-background-color: #047857;
    --tag-part-of-speech-background-color: #565656;
    --tag-search-background-color: #69696e;
    --tag-pronunciation-dictionary-background-color: #7c3aed;

    --sidebar-background-color: #282828;

    --sidebar-button-background-color: transparent;
    --sidebar-button-background-color-hover: #3a3a3a;
    --sidebar-button-background-color-active: #5a5a5a;
    --sidebar-button-danger-background-color: transparent;
    --sidebar-button-danger-background-color-hover: #dd2222;
    --sidebar-button-danger-background-color-active: #bb2222;
    --sidebar-button-icon-color: #cccccc;
    --sidebar-button-disabled-icon-color: #777777;
    --sidebar-button-danger-icon-color: #ffffff;

    --scrollbar-thumb-color: #444444;
    --scrollbar-track-color: #2f2f2f;
    --scrollbar-inverse-thumb-color: #c1c1c1;
    --scrollbar-inverse-track-color: #f1f1f1;

    --progress-bar-track-color: #3a3a3a;
    --progress-bar-indicator-color: var(--accent-color);
    --entry-current-indicator-color: var(--accent-color);

    --notification-text-color: #ffffff;
    --notification-background-color: #333333;
    --notification-background-color-light: #555555;
    --notification-background-color-lighter: #666666;
    --notification-shadow-color: rgba(0, 0, 0, 0.5);

    --action-button-hover-color: #282828;
    --action-button-active-color: #444444;
}

/* Action buttons */
.actions {
    display: flex;
    flex-flow: row nowrap;
    float: right;
    margin: -0.25em;
    position: relative;
    z-index: 1;
}

.actions::after {
    clear: both;
    content: '';
    display: block;
}

.note-actions-container {
    display: flex;
    flex-flow: row nowrap;
    align-items: start;
}

.action-button-container {
    display: flex;
    flex-direction: column;
    position: relative;
}

.note-actions-container .action-button-container::after {
    content: '';
    position: absolute;
    left: calc(50% - 0.5px);
    top: calc((var(--action-button-size) + var(--action-button-padding) * 2) * 0.5);
    bottom: calc((var(--action-button-size) + var(--action-button-padding) * 2) * 0.5);
    width: 1px;
    background: var(--accent-color);
    pointer-events: none;
    opacity: 0.25;
    z-index: -1;
}

.note-actions-container .action-button-container:first-child {
    flex-direction: row-reverse;
}

.note-actions-container .action-button-container:first-child::after {
    top: calc(50% - 0.5px);
    left: calc((var(--action-button-size) + var(--action-button-padding) * 2) * 0.5);
    right: calc((var(--action-button-size) + var(--action-button-padding) * 2) * 0.5);
    bottom: auto;
    height: 1px;
    width: auto;
}

.note-actions-container .action-button-container:only-child::after {
    display: none;
}

button.action-button {
    cursor: pointer;
    display: block;
    opacity: 1;
    border: 0;
    margin: 0;
    padding: var(--action-button-padding);
    background: transparent;
    font-size: inherit;
    box-shadow: none;
    position: relative;
    z-index: 1;
    transition:
        opacity var(--animation-duration) linear,
        visibility 0s linear 0s,
        filter var(--animation-duration) linear,
        -webkit-filter var(--animation-duration) linear,
        background-color var(--animation-duration) linear;
}

button.action-button[hidden] {
    display: block;
    visibility: hidden;
    opacity: 0;
    transition:
        opacity var(--animation-duration) linear,
        visibility 0s linear var(--animation-duration),
        filter var(--animation-duration) linear,
        -webkit-filter var(--animation-duration) linear,
        background-color var(--animation-duration) linear;
}

button.action-button-collapsible[hidden] {
    display: none;
}

button.action-button:disabled {
    pointer-events: auto;
    cursor: default;
    -webkit-filter: grayscale(100%);
    filter: grayscale(100%);
    background-color: transparent;
}

button.action-button:disabled:not([hidden]) {
    opacity: 0.25;
}

button.action-button:hover,
button.action-button:focus {
    background-color: transparent;
    box-shadow: none;
}

button.action-button:focus-visible {
    background-color: var(--action-button-hover-color);
    box-shadow: none;
}

button.action-button:active:not(:disabled) {
    background-color: var(--action-button-active-color);
    box-shadow: none;
}

.icon[data-icon=play-audio] {
    background-image: url('../../icons/play-audio.svg');
}

.icon[data-icon=source-term] {
    background-image: url('../../icons/source-term.svg');
}

.icon[data-icon=entry-current] {
    background-image: url('../../icons/entry-current.svg');
}

.action-icon {
    display: block;
    width: var(--action-button-size);
    height: var(--action-button-size);
}

.action-icon:not(.color-icon) {
    background-color: var(--text-color);
}

:root[data-result-output-mode=merge] .entry[data-type=term] .actions>button.action-button[data-action=play-audio] {
    display: none;
}

.action-button-badge {
    pointer-events: none;
    position: absolute;
    display: block;
    right: 0;
    top: 0;
    width: calc(8em / var(--font-size-no-units));
    height: calc(8em / var(--font-size-no-units));
}

.action-button-badge[data-icon=cross] {
    background-color: var(--danger-color);
}

.action-button-badge[data-icon=plus-thick] {
    background-color: var(--success-color);
}


/* Tags */
.tag {
    --tag-color: var(--tag-default-background-color);

    display: inline-flex;
    flex-flow: row nowrap;
    align-items: stretch;
    border: none;
    border-right: none;
    font-size: 1em;
    min-height: var(--tag-height);
    margin: calc(1em / var(--font-size-no-units)) 0.375em calc(1em / var(--font-size-no-units)) 0;
}

.tag-label {
    display: flex;
    flex-flow: row nowrap;
    align-items: center;
    background-color: #66648b;
    border-radius: var(--tag-border-radius);
    padding: calc(2.5em / var(--font-size-no-units)) 0.375em calc(2.5em / var(--font-size-no-units)) 0.375em;
    color: var(--tag-text-color);
    cursor: pointer;
}

.tag-label-content {
    display: block;
    font-size: var(--tag-font-size);
    font-weight: var(--tag-font-weight);
}

.tag-body {
    display: flex;
    flex-flow: row nowrap;
    align-items: center;
    position: relative;
    padding: 0 0.375em 0 0.375em;
    border-radius: var(--tag-border-radius);
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
}

.tag-body::before {
    content: '';
    display: block;
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    right: 0;
    border-radius: var(--tag-border-radius);
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
    border: var(--tag-border-size) var(--tag-border-style) var(--tag-color);
    border-left: none;
    pointer-events: none;
}

.tag-body-content {
    display: block;
    position: relative;
}

.tag:not(.tag-has-body)>.tag-body {
    display: none;
}

.tag.tag-has-body>.tag-label {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
}

.tag[data-category=name] {
    --tag-color: var(--tag-name-background-color);
}

.tag[data-category=expression] {
    --tag-color: var(--tag-expression-background-color);
}

.tag[data-category=popular] {
    --tag-color: var(--tag-popular-background-color);
}

.tag[data-category=frequent] {
    --tag-color: var(--tag-frequent-background-color);
    display: none;
}

.tag[data-category=archaism] {
    --tag-color: var(--tag-archaism-background-color);
}

.tag[data-category=archaism] .tag-label .tag-label-content {
    color: hsl(0, 100%, 45%);
}

.tag[data-category=dictionary] {
    --tag-color: var(--tag-dictionary-background-color);
    display: none;
}

.tag[data-category=frequency] {
    --tag-color: var(--tag-frequency-background-color);
    display: none;
}

.tag[data-category=partOfSpeech] {
    --tag-color: var(--tag-part-of-speech-background-color);
}

.tag[data-category=search] {
    --tag-color: var(--tag-search-background-color);
}

.tag[data-category=pronunciation-dictionary] {
    --tag-color: var(--tag-pronunciation-dictionary-background-color);
}


/* Entries */
.entry {
    padding: var(--entry-vertical-padding) var(--entry-horizontal-padding);
    position: relative;
    content-visibility: auto;
    contain-intrinsic-height: auto 500px;
}

.entry+.entry {
    border-top: var(--thin-border-size) solid var(--light-border-color);
}

.entry-body {
    clear: both;
}

.entry[data-definition-count='0'] .entry-body-section[data-section-type=definitions],
.entry[data-frequency-count='0'] .entry-body-section[data-section-type=frequencies],
.entry[data-pronunciation-count='0'] .entry-body-section[data-section-type=pronunciations] {
    display: none;
}


/* Inflections */
.inflection-rule-chains {
    padding-inline-start: 0;
    list-style-type: none;
}

.inflection-rule-chain {
    color: var(--reason-text-color);
}

.inflection-rule-chain:empty {
    display: none;
}

.inflection-rule-chain>.inflection+.inflection-separator+.inflection::before {
    content: var(--inflection-separator);
    padding: 0 0.25em;
}

.inflection-source-icon {
    display: inline-block;
    white-space: nowrap;
    text-align: center;
    width: 1.4em;
    margin-right: 0.2em;
}

.inflection-source-icon[data-inflection-source='dictionary']::after {
    content: 'ðŸ“–';
}

.inflection-source-icon[data-inflection-source='algorithm']::after {
    content: 'ðŸ§©';
}

.inflection-source-icon[data-inflection-source='both'] {
    width: 2.8em;
}

.inflection-source-icon[data-inflection-source='both']::after {
    content: 'ðŸ§©ðŸ“–';
}

.inflection[title] {
    cursor: pointer;
}


/* Headwords */
.headword-list {
    display: inline;
    margin-right: var(--headword-list-end-space);
}

.headword {
    --headword-current-text-color: var(--headword-text-color);
    --headword-current-reading-text-color: var(--headword-reading-text-color);
    --headword-current-furigana-text-color: var(--headword-furigana-text-color);
    --headword-current-kanji-text-color: var(--headword-kanji-text-color);
    --headword-current-kanji-border-color: var(--headword-kanji-border-color);

    display: inline-block;
}

:root[data-result-output-mode=merge] .headword[data-frequency=popular] {
    --headword-current-text-color: var(--headword-text-color-popular);
    --headword-current-reading-text-color: var(--headword-reading-text-color-popular);
    --headword-current-furigana-text-color: var(--headword-furigana-text-color-popular);
    --headword-current-kanji-text-color: var(--headword-kanji-text-color-popular);
    --headword-current-kanji-border-color: var(--headword-kanji-border-color-popular);
}

:root[data-result-output-mode=merge] .headword[data-frequency=rare] {
    --headword-current-text-color: var(--headword-text-color-rare);
    --headword-current-reading-text-color: var(--headword-reading-text-color-rare);
    --headword-current-furigana-text-color: var(--headword-furigana-text-color-rare);
    --headword-current-kanji-text-color: var(--headword-kanji-text-color-rare);
    --headword-current-kanji-border-color: var(--headword-kanji-border-color-rare);
    font-size: 80%;
}

.headword-details {
    display: inline;
}

.headword-list-details {
    display: block;
}

.headword-list-tag-list {
    display: inline;
}
.headword-list-tag-list .tag .tag-label {
    font-size: 0 !important;
    visibility: hidden;
}

.headword-list-tag-list .tag .tag-label .tag-label-content {
    visibility: visible;
    font-size: 1.2rem;
    line-height: 1;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.7);
}

.headword-text-container {
    display: inline-block;
    margin-left: calc(-1 * var(--headword-reading-space));
}

.headword-term-outer {
    display: inline-block;
    position: relative;
    margin-left: var(--headword-reading-space);
}

.headword-reading-outer {
    display: none;
    position: relative;
    margin-left: var(--headword-reading-space);
}

.headword-term {
    color: var(--headword-current-text-color);
    font-size: var(--headword-font-size);
    font-weight: bold;
    /* Wanchan Bold */
}

.headword-reading {
    color: var(--headword-current-reading-text-color);
    font-size: var(--headword-reading-font-size);
}

.headword-list>.headword:not(:last-of-type)>.headword-text-container>.headword-term-outer::after {
    content: var(--headword-separator);
    font-size: var(--headword-font-size);
}

.headword-list>.headword:not(:last-of-type)>.headword-text-container>.headword-reading-outer::after {
    content: var(--headword-separator);
    font-size: var(--headword-reading-font-size);
}

.headword-term>ruby>rt {
    color: var(--headword-current-furigana-text-color);
}

.headword-kanji-link {
    text-decoration: underline dashed var(--headword-current-kanji-border-color) var(--headword-thin-border-size);
    text-underline-offset: calc(var(--headword-font-size) / 15);
    color: var(--headword-current-kanji-text-color);
    cursor: pointer;
}

:root[data-result-output-mode=merge] .headword-list-details {
    display: inline;
}

:root[data-term-display-mode=ruby-and-reading] .headword-term-outer::after,
:root[data-term-display-mode=term-and-reading] .headword-term-outer::after {
    display: none;
}

:root[data-term-display-mode=ruby-and-reading] .headword-reading-outer,
:root[data-term-display-mode=term-and-reading] .headword-reading-outer {
    display: inline-block;
}

:root[data-term-display-mode=ruby-and-reading] .headword[data-reading-is-same=true] .headword-term-outer::after,
:root[data-term-display-mode=term-and-reading] .headword[data-reading-is-same=true] .headword-term-outer::after {
    display: inline-block;
}

:root[data-term-display-mode=ruby-and-reading] .headword[data-reading-is-same=true] .headword-reading-outer,
:root[data-term-display-mode=term-and-reading] .headword[data-reading-is-same=true] .headword-reading-outer {
    display: none;
}

:root[data-term-display-mode=term-and-reading] .headword-term>ruby>rt,
:root[data-term-display-mode=term-only] .headword-term>ruby>rt {
    display: none;
}

/* Definitions */
.definition-list {
    margin: 0;
    padding: 0 0 0 var(--list-padding1);
    list-style-type: decimal;
}

.definition-list[data-count='0'],
.definition-list[data-count='1'] {
    padding-left: 0;
    list-style-type: none;
}

.gloss-list {
    margin: 0;
    padding: 0 0 0 var(--list-padding2);
    list-style-type: circle;
}

.gloss-list[data-count='0'],
.gloss-list[data-count='1'] {
    padding-left: 0;
    list-style-type: none;
}

.definition-item::marker,
.gloss-item::marker {
    color: var(--text-color-light3);
}

.gloss-content {
    display: block;
    white-space: pre-line;
    font-weight: bold;
}

.definition-disambiguation-list {
    color: var(--text-color-light3);
    padding-right: var(--disambiguation-space);
}

.definition-disambiguation-list[data-count='0'] {
    display: none;
}

.definition-disambiguation+.definition-disambiguation::before {
    content: var(--disambiguation-separator);
}

.gloss-separator,
.inflection-separator {
    display: inline;
    font-size: 0;
    opacity: 0;
    white-space: pre-wrap;
}

.gloss-separator {
    display: none;
}

.definition-item {
    display: list-item;
    position: relative;
}

.definition-item-inner {
    display: flex;
    flex-flow: row nowrap;
}

.definition-item-content {
    width: 100%;
    flex: 1 1 auto;
    background-color: transparent;
    transition: background-color var(--animation-duration) ease-in-out;
}